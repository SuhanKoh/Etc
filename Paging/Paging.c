/*  Paging  Created by Suhan Koh on 4/22/15.  Updated: 9/15/2015.  Copyright (c) 2015 Suhan Koh. All rights reserved.*/#include <stdio.h>#include <stdlib.h>#include <math.h>#include <string.h>int pageFault = 0;int frameSize = 0;int pageSize, logicalMemSize, frames; /*Inputs*/int queuePtr = 0;int currentFrame = 0;int counter = 0;typedef struct{    int isValid;    int pageFrame;    int counter; /*Make sure this doesn't go over frame size*/}PageTable;typedef struct{    int page;    int counter; /*For LRU only*/}InvertedPageTable;void FIFO(PageTable *PT, int pageNum, InvertedPageTable *invertedPageTable){    if(PT[pageNum].isValid != 1)    {        pageFault++;        if(frameSize < frames)        {            PT[pageNum].isValid = 1;            PT[pageNum].pageFrame = currentFrame;            invertedPageTable[queuePtr%frames].page = pageNum;            queuePtr++;            frameSize++;        }else        {            PT[pageNum].isValid = 1;            PT[pageNum].pageFrame = currentFrame;            PT[invertedPageTable[queuePtr%frames].page].isValid = -1;            invertedPageTable[queuePtr%frames].page = pageNum;            queuePtr++;        }        currentFrame = (currentFrame+1)%frames;    }}void LRU(PageTable *PT, int pageNum, InvertedPageTable *invertedPageTable){   int victimFrame, victimFrameCounter, victimFramePage, i, j;    counter++;    if(PT[pageNum].isValid != 1)    {        pageFault++;        if(frameSize < frames)        {            PT[pageNum].isValid = 1;            PT[pageNum].pageFrame = currentFrame;            invertedPageTable[queuePtr%frames].page = pageNum;            invertedPageTable[queuePtr%frames].counter = counter;            queuePtr++;            frameSize++;        }else        {            PT[pageNum].isValid = 1;            PT[pageNum].pageFrame = currentFrame;            victimFrameCounter = invertedPageTable[0].counter;            victimFrame = 0;            for(i = 1; i < frames; i++)            {                if(victimFrameCounter > invertedPageTable[i].counter)                {                    victimFramePage = invertedPageTable[i].page;                    victimFrameCounter = invertedPageTable[i].counter;                    victimFrame = i;                }else{                    victimFramePage = invertedPageTable[victimFrame].page;                }            }            PT[invertedPageTable[victimFrame].page].isValid = -1;            invertedPageTable[victimFrame].page = pageNum;            invertedPageTable[victimFrame].counter = counter;        }        currentFrame = (currentFrame+1)%frames;    }else if(PT[pageNum].isValid == 1)    {        for(i = 0; i < frames; i++)        {            if(pageNum == invertedPageTable[i].page)            {                invertedPageTable[i].counter = counter;                break;            }        }    }}int main(int argc, const char * argv[]) {    char algorithm[5], inputString[7];    int pageCount;    InvertedPageTable *invertedPageTable;    int i;    PageTable *PT;    /*FIFO Algorithm*/    int pageNum;    int hex;    if(argc < 5)    {        printf("Incorrect arguments count. %d\n", argc);    }    else    {        pageSize = (int) pow(2, atoi(argv[1]));        /*get the inputs*/        logicalMemSize = (int) pow(2, atoi(argv[2]));        strncpy(algorithm, argv[3], 5);        frames = atoi(argv[4]);        pageCount = (int) pow(2, (atoi(argv[2])-atoi(argv[1])));        PT = (PageTable *)malloc(pageCount * sizeof(PageTable));        for(i = 0; i < pageCount; i++)        {            PT[i].isValid = 0;            PT[i].pageFrame = -1;        }        invertedPageTable = (InvertedPageTable *) malloc(frames * sizeof(InvertedPageTable));        while(fgets(inputString, 7, stdin)){            if(strcmp(inputString, "\n") != 0)            { /*kick off the "enter" when using stdin*/                hex = (int)strtol(inputString, NULL, 0);                /*FIFO algorithm*/                if(strcmp(algorithm, "FIFO") == 0)                {                    pageNum = (int) (hex/pageSize);                    FIFO(PT, pageNum, invertedPageTable);                } else{                    pageNum = (int) (hex/pageSize);                    LRU(PT, pageNum, invertedPageTable);                }            }        }    }    printf("PAGE FAULT : %d\n", pageFault);    free(PT); /*Free Page table*/    free(invertedPageTable);    return 0;}